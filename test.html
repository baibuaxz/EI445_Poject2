<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bill-Shock Early Warning Dashboard</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f5f7;
      color: #111827;
      min-height: 100vh;
      padding: 20px;
      line-height: 1.5;
      transition: background .25s ease, color .25s ease;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    button {
      font-family: inherit;
      cursor: pointer;
    }

    .header {
      background: #ffffff;
      padding: 20px 22px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, .08);
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      flex-wrap: wrap;
    }

    .title-block h1 {
      font-size: 24px;
      font-weight: 600;
    }

    .subtitle {
      font-size: 14px;
      color: #6b7280;
      margin-top: 4px;
    }

    .mode-text {
      font-size: 13px;
      color: #6b7280;
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
    }

    .back-btn,
    .theme-toggle {
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      padding: 7px 12px;
      border-radius: 999px;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: .2s;
      white-space: nowrap;
    }

    .back-btn span.icon {
      font-size: 16px;
      transform: translateY(-1px);
    }

    .back-btn:hover {
      background: #111827;
      border-color: #111827;
      color: #fff;
    }

    .theme-toggle {
      font-size: 12px;
    }

    .theme-toggle:hover {
      background: #e5e7eb;
    }

    .status-banner {
      padding: 14px 18px;
      border-radius: 14px;
      font-weight: 500;
      margin-bottom: 16px;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      color: #fff;
    }

    .status-badge {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, .7);
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .status-normal {
      background: #16a34a;
    }

    .status-mild {
      background: #ea580c;
    }

    .status-moderate {
      background: #c2410c;
    }

    .status-severe {
      background: #b91c1c;
    }

    /* MINI CARDS */
    .mini-card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 14px;
      margin-bottom: 18px;
    }

    .mini-card {
      background: #ffffff;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 4px 14px rgba(15, 23, 42, .08);
      border: 1px solid #e5e7eb;
      cursor: pointer;
      transition: .18s ease;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .mini-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(15, 23, 42, .12);
    }

    .m-header {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .m-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
    }

    .m-icon-spent {
      background: #eff6ff;
      color: #1d4ed8;
    }

    .m-icon-projected {
      background: #fef3c7;
      color: #92400e;
    }

    .m-icon-budget {
      background: #ecfdf3;
      color: #15803d;
    }

    .m-icon-avg {
      background: #f5f3ff;
      color: #5b21b6;
    }

    .m-title {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: .06em;
    }

    .m-value {
      font-size: 20px;
      font-weight: 600;
      color: #111827;
    }

    .m-foot {
      font-size: 11px;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .m-foot span.icon {
      font-size: 14px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-bottom: 18px;
    }

    .card {
      background: #fff;
      border-radius: 12px;
      padding: 16px 18px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, .06);
      border: 1px solid #e5e7eb;
    }

    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      color: #6b7280;
      letter-spacing: .07em;
      margin-bottom: 6px;
    }

    .stat-value {
      font-size: 26px;
      font-weight: 600;
    }

    .stat-change {
      font-size: 13px;
      margin-top: 4px;
      color: #6b7280;
    }

    .positive {
      color: #16a34a;
    }

    .negative {
      color: #b91c1c;
    }

    .progress-card {
      margin-bottom: 18px;
    }

    .progress-bar {
      height: 24px;
      border-radius: 999px;
      background: #f3f4f6;
      overflow: hidden;
      border: 1px solid #e5e7eb;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #fb923c, #facc15);
      color: #111827;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      transition: width .7s;
      white-space: nowrap;
    }

    .progress-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 12px;
      color: #6b7280;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
      gap: 18px;
      margin-bottom: 18px;
    }

    .chart-card h3 {
      font-size: 15px;
      margin-bottom: 10px;
      font-weight: 500;
    }

    .action-plan h3,
    .insight-card h3 {
      font-size: 15px;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .action-item {
      background: #f9fafb;
      border-radius: 8px;
      padding: 8px 10px;
      margin-bottom: 6px;
      border-left: 3px solid #fb923c;
      font-size: 14px;
      color: #111827;
    }

    #planSummary {
      margin-top: 10px;
      padding: 8px 10px;
      background: #fff7ed;
      border-radius: 8px;
      font-size: 13px;
      color: #7c2d12;
      border: 1px solid #fed7aa;
    }

    .insight-text {
      font-size: 14px;
      color: #111827;
      margin-bottom: 6px;
    }

    .insight-list {
      list-style: disc;
      padding-left: 18px;
      font-size: 13px;
      color: #374151;
    }

    .insight-list li {
      margin-bottom: 4px;
    }

    .modal-overlay {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      background: rgba(15, 23, 42, .65);
      z-index: 50;
    }

    .modal {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, .45);
      width: 90%;
      max-width: 420px;
      padding: 20px 20px 14px;
      animation: pop .25s ease;
    }

    @keyframes pop {
      from {
        transform: scale(.92);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .modal h2 {
      font-size: 18px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .modal p {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 14px;
    }

    .option-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 6px;
    }

    .option-btn {
      width: 100%;
      text-align: left;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #111827;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: .16s ease;
    }

    .option-btn .label {
      font-weight: 500;
    }

    .option-btn .desc {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
      display: block;
    }

    .option-btn:hover {
      background: #111827;
      color: #ffffff;
      border-color: #111827;
    }

    .option-btn:hover .desc {
      color: #e5e7eb;
    }

    .option-arrow {
      font-size: 16px;
    }

    .modal-footer {
      margin-top: 6px;
      font-size: 11px;
      color: #9ca3af;
      text-align: right;
    }

    /* POPUP ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î MINI CARD */
    .detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, .55);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 60;
    }

    .detail-box {
      background: #ffffff;
      width: 90%;
      max-width: 420px;
      border-radius: 16px;
      padding: 18px 18px 14px;
      box-shadow: 0 18px 60px rgba(0, 0, 0, .6);
      animation: pop .22s ease;
    }

    .detail-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .detail-title {
      font-size: 16px;
      font-weight: 600;
    }

    .detail-chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      color: #6b7280;
      margin-top: 2px;
      display: inline-block;
    }

    .detail-close {
      border: none;
      background: transparent;
      font-size: 22px;
      cursor: pointer;
      color: #6b7280;
    }

    .detail-body {
      font-size: 13px;
      color: #374151;
    }

    .detail-body p {
      margin-bottom: 6px;
    }

    .detail-body ul {
      margin-top: 4px;
      padding-left: 18px;
    }

    .detail-body li {
      margin-bottom: 3px;
    }

    #main {
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .25s ease, transform .25s ease;
    }

    #main.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* NIGHT MODE */
    body.theme-night {
      background: #0b0f19;
      color: #e5e7eb;
    }

    body.theme-night .header {
      background: #020617;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .6);
      border: 1px solid #111827;
    }

    body.theme-night .card,
    body.theme-night .modal,
    body.theme-night .option-btn,
    body.theme-night .mini-card,
    body.theme-night .detail-box {
      background: #020617;
      border-color: #1f2937;
      color: #e5e7eb;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .6);
    }

    body.theme-night .stat-label,
    body.theme-night .stat-change,
    body.theme-night .subtitle,
    body.theme-night .mode-text,
    body.theme-night .modal p {
      color: #9ca3af;
    }

    body.theme-night .status-banner {
      box-shadow: 0 10px 30px rgba(0, 0, 0, .7);
    }

    body.theme-night .progress-bar {
      background: #020617;
      border-color: #1f2937;
    }

    body.theme-night .action-item {
      background: #020617;
      border-color: #fb923c;
      color: #e5e7eb;
    }

    body.theme-night .insight-text,
    body.theme-night .insight-list li {
      color: #e5e7eb;
    }

    body.theme-night .back-btn,
    body.theme-night .theme-toggle {
      background: #020617;
      border-color: #374151;
      color: #e5e7eb;
    }

    body.theme-night .back-btn:hover {
      background: #e5e7eb;
      color: #020617;
      border-color: #e5e7eb;
    }

    body.theme-night .theme-toggle:hover {
      background: #111827;
    }

    body.theme-night .detail-chip {
      background: #111827;
      color: #9ca3af;
    }

    body.theme-night #planSummary {
      background: #451a03;
      color: #fed7aa;
      border-color: #9a3412;
    }
  </style>
</head>

<body>
  <div class="container" id="main">
    <header class="header">
      <div class="header-top">
        <div class="title-block">
          <h1>Bill-Shock Early Warning</h1>
          <p class="subtitle">
            ‡∏à‡∏±‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì ‚Äú‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏ö‡∏≤‡∏ô‚Äù ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á / ‡∏£‡∏≤‡∏¢ 15 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
          </p>
          <p class="mode-text" id="modeText">
            ‡πÇ‡∏´‡∏°‡∏î: ‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô /‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®)
          </p>
        </div>
        <div class="header-actions">
          <button class="back-btn" onclick="history.back()">
            <span class="icon">‚Üê</span>
            ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°
          </button>
          <button class="theme-toggle" id="themeToggle">
            ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô / ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô
          </button>
        </div>
      </div>
    </header>

    <!-- ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
    <section id="statusBanner" class="status-banner status-normal">
      <div>
        <div class="status-badge" id="statusBadge">NORMAL</div>
        <div id="statusText">
          ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏á‡∏ö ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì Bill-Shock
        </div>
      </div>
      <div style="font-size:13px;opacity:.9;" id="statusExtra">
        ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets / n8n ‡πÅ‡∏ó‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï
      </div>
    </section>

    <!-- MINI CARDS -->
    <section class="mini-card-grid">
      <div class="mini-card" data-type="spent">
        <div class="m-header">
          <div class="m-icon m-icon-spent">‡πÉ‡∏ä‡πâ</div>
          <div>
            <div class="m-title">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß</div>
            <div class="m-value" id="spentValue">‚Äì ‡∏ö‡∏≤‡∏ó</div>
          </div>
        </div>
        <div class="m-foot">
          <span id="spentFoot">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -</span>
          <span class="icon">‚ãØ</span>
        </div>
      </div>

      <div class="mini-card" data-type="projected">
        <div class="m-header">
          <div class="m-icon m-icon-projected">‡∏Ñ‡∏≤‡∏î</div>
          <div>
            <div class="m-title">‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            <div class="m-value" id="projectedValue">‚Äì ‡∏ö‡∏≤‡∏ó</div>
          </div>
        </div>
        <div class="m-foot">
          <span id="projectedFoot">Projection = Trend ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
          <span class="icon">üìà</span>
        </div>
      </div>

      <div class="mini-card" data-type="budget">
        <div class="m-header">
          <div class="m-icon m-icon-budget">‡∏á‡∏ö</div>
          <div>
            <div class="m-title">‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
            <div class="m-value" id="budgetValue">‚Äì ‡∏ö‡∏≤‡∏ó</div>
          </div>
        </div>
        <div class="m-foot">
          <span id="budgetFoot">‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
          <span class="icon">üéØ</span>
        </div>
      </div>

      <div class="mini-card" data-type="avg">
        <div class="m-header">
          <div class="m-icon m-icon-avg">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
          <div>
            <div class="m-title">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</div>
            <div class="m-value" id="avgValue">‚Äì ‡∏ö‡∏≤‡∏ó</div>
          </div>
        </div>
        <div class="m-foot">
          <span id="avgFoot">‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πá‡∏ô baseline</span>
          <span class="icon">üßÆ</span>
        </div>
      </div>
    </section>

    <!-- PROGRESS -->
    <section class="card progress-card">
      <div class="stat-label">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width:5%;">
          ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì...
        </div>
      </div>
      <div class="progress-footer">
        <span id="progressLabelLeft">0% ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö</span>
        <span id="progressLabelRight">‡πÄ‡∏õ‡πâ‡∏≤: ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 100%</span>
      </div>
    </section>

    <!-- CHARTS -->
    <section class="charts-grid">
      <div class="card chart-card">
        <h3>‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (kWh)</h3>
        <canvas id="usageTrendChart" height="140"></canvas>
      </div>
      <div class="card chart-card">
        <h3>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô / ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô)</h3>
        <canvas id="costBreakdownChart" height="140"></canvas>
      </div>
    </section>

    <!-- ACTION & INSIGHT -->
    <section class="stats-grid">
      <div class="card action-plan">
        <h3>‡πÅ‡∏ú‡∏ô‡∏•‡∏î‡πÇ‡∏´‡∏•‡∏î 3 ‡∏£‡∏∞‡∏î‡∏±‡∏ö (Lite / Balance / Max)</h3>
        <div class="action-item">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏á‡∏ö ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô ‚Äú‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏°‡∏≤‡∏Å‚Äù
        </div>
        <button class="back-btn" id="openPlansButton">
          ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏•‡∏î‡πÇ‡∏´‡∏•‡∏î
        </button>
        <div id="planSummary">
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        </div>
      </div>

      <div class="card insight-card">
        <h3>Insight ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
        <p class="insight-text" id="insightMain">
          ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å...
        </p>
        <ul class="insight-list" id="insightList">
          <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å JS -->
        </ul>
      </div>
    </section>
  </div>

  <!-- MODAL ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏•‡∏î‡πÇ‡∏´‡∏•‡∏î -->
  <div class="modal-overlay" id="planModal">
    <div class="modal">
      <h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏•‡∏î‡πÇ‡∏´‡∏•‡∏î</h2>
      <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö ‚Äú‡∏ö‡∏µ‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‚Äù ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>

      <div class="option-list">
        <button class="option-btn" data-level="lite">
          <div>
            <span class="label">Lite ‚Äì ‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏ü‡∏∏‡πà‡∏°‡πÄ‡∏ü‡∏∑‡∏≠‡∏¢‡πÄ‡∏ö‡∏≤ ‡πÜ</span>
            <span class="desc">‡∏õ‡∏¥‡∏î‡πÑ‡∏ü / ‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô, ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå +1¬∞C</span>
          </div>
          <span class="option-arrow">‚Ä∫</span>
        </button>

        <button class="option-btn" data-level="balance">
          <div>
            <span class="label">Balance ‚Äì ‡πÄ‡∏≠‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏™‡∏ö‡∏≤‡∏¢</span>
            <span class="desc">‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡∏•‡∏î‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Å</span>
          </div>
          <span class="option-arrow">‚Ä∫</span>
        </button>

        <button class="option-btn" data-level="max">
          <div>
            <span class="label">Max ‚Äì ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ã‡∏ü‡∏à‡∏±‡∏î‡πÄ‡∏ï‡πá‡∏°</span>
            <span class="desc">‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏¥‡∏ô‡πÑ‡∏ü‡∏™‡∏π‡∏á‡πÅ‡∏ó‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î, ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÜ</span>
          </div>
          <span class="option-arrow">‚Ä∫</span>
        </button>
      </div>

      <div class="modal-footer">
        * ‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡πâ‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      </div>
    </div>
  </div>

  <!-- DETAIL OVERLAY -->
  <div class="detail-overlay" id="detailOverlay">
    <div class="detail-box">
      <div class="detail-header">
        <div>
          <div class="detail-title" id="detailTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
          <div class="detail-chip" id="detailChip">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ</div>
        </div>
        <button class="detail-close" id="detailCloseBtn">&times;</button>
      </div>
      <div class="detail-body" id="detailBody">
        <!-- ‡πÄ‡∏ï‡∏¥‡∏°‡∏à‡∏≤‡∏Å JS -->
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const mainEl = document.getElementById("main");
      mainEl.classList.add("show");

      // --------- DATA ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö n8n / Sheets ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á) ----------
      const budget = 1500;     // ‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)
      const avg3Months = 1400; // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏ö‡∏≤‡∏ó)

      const today = new Date();
      const dayOfMonth = today.getDate();   // ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏£‡∏¥‡∏á
      const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();

      // ‡∏à‡∏≥‡∏•‡∏≠‡∏á "‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß" ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÄ‡∏ä‡πà‡∏ô 620 ‡∏ö‡∏≤‡∏ó
      const spentSoFar = 620;

      // ‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏£‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡πÜ)
      const projected = Math.round(spentSoFar / dayOfMonth * daysInMonth);

      // ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏á‡∏ö
      let usagePct = projected / budget * 100;
      if (usagePct > 180) usagePct = 180; // cap ‡πÅ‡∏ó‡πà‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

      // --------- ‡πÄ‡∏ï‡∏¥‡∏° MINI CARDS ----------
      const spentValueEl = document.getElementById("spentValue");
      const projectedValueEl = document.getElementById("projectedValue");
      const budgetValueEl = document.getElementById("budgetValue");
      const avgValueEl = document.getElementById("avgValue");

      spentValueEl.textContent = spentSoFar.toLocaleString("th-TH") + " ‡∏ø";
      projectedValueEl.textContent = projected.toLocaleString("th-TH") + " ‡∏ø";
      budgetValueEl.textContent = budget.toLocaleString("th-TH") + " ‡∏ø";
      avgValueEl.textContent = avg3Months.toLocaleString("th-TH") + " ‡∏ø";

      document.getElementById("spentFoot").textContent =
        `‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${dayOfMonth}/${today.getMonth() + 1}`;
      document.getElementById("projectedFoot").textContent =
        `‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ß‡∏±‡∏ô‡∏•‡∏∞ ${(spentSoFar / dayOfMonth).toFixed(1)} ‡∏ø`;
      document.getElementById("budgetFoot").textContent =
        `‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö +10% ‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (${avg3Months.toLocaleString("th-TH")} ‡∏ø)`;
      document.getElementById("avgFoot").textContent =
        `‡πÄ‡∏≠‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô`;

      // --------- STATUS BANNER ----------
      const statusBanner = document.getElementById("statusBanner");
      const statusBadge = document.getElementById("statusBadge");
      const statusText = document.getElementById("statusText");
      const statusExtra = document.getElementById("statusExtra");

      function setStatus(pct) {
        statusBanner.classList.remove("status-normal", "status-mild", "status-moderate", "status-severe");

        if (pct < 80) {
          statusBanner.classList.add("status-normal");
          statusBadge.textContent = "NORMAL";
          statusText.textContent = "‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏à‡∏∞‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏á‡∏ö‡∏û‡∏≠‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á Bill-Shock";
          statusExtra.textContent = "‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏î‡∏µ ‡πÜ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô";
        } else if (pct < 100) {
          statusBanner.classList.add("status-mild");
          statusBadge.textContent = "WATCH";
          statusText.textContent = "‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏á‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Å";
          statusExtra.textContent = "‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå +1¬∞C / ‡∏õ‡∏¥‡∏î‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å";
        } else if (pct < 120) {
          statusBanner.classList.add("status-moderate");
          statusBadge.textContent = "ALERT";
          statusText.textContent = "‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î Bill-Shock";
          statusExtra.textContent = "‡∏•‡∏≠‡∏á‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô ‚ÄòBalance‚Äô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏û‡∏µ‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å";
        } else {
          statusBanner.classList.add("status-severe");
          statusBadge.textContent = "CRITICAL";
          statusText.textContent = "‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ó‡∏∞‡∏•‡∏∏‡∏á‡∏ö‡πÄ‡∏¢‡∏≠‡∏∞‡∏°‡∏≤‡∏Å ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á Bill-Shock ‡∏™‡∏π‡∏á";
          statusExtra.textContent = "‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î ‚ÄòMax‚Äô ‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏¥‡∏ô‡πÑ‡∏ü‡∏´‡∏ô‡∏±‡∏Å ‡πÜ ‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô";
        }
      }
      setStatus(usagePct);

      // --------- PROGRESS BAR ----------
      const progressFill = document.getElementById("progressFill");
      const progressLabelLeft = document.getElementById("progressLabelLeft");
      const progressLabelRight = document.getElementById("progressLabelRight");

      progressFill.style.width = Math.min(usagePct, 100) + "%";
      progressFill.textContent = `${usagePct.toFixed(0)}% ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå`;
      progressLabelLeft.textContent =
        `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ${spentSoFar.toLocaleString("th-TH")} ‡∏ø ‡∏à‡∏≤‡∏Å‡∏á‡∏ö ${budget.toLocaleString("th-TH")} ‡∏ø`;
      progressLabelRight.textContent =
        projected > budget
          ? `‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${(projected - budget).toLocaleString("th-TH")} ‡∏ø`
          : `‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${(budget - projected).toLocaleString("th-TH")} ‡∏ø`;

      // --------- CHART: Usage Trend ----------
      const usageCtx = document.getElementById("usageTrendChart").getContext("2d");
      const labelsDays = Array.from({ length: dayOfMonth }, (_, i) => i + 1);

      const kWhPerDay = labelsDays.map(d => {
        // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏ö‡∏≤ ‡πÜ ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô ‡πÜ ‡∏•‡∏á ‡πÜ
        const base = 9 + (Math.sin(d / 3) * 2);
        return Math.max(5, base + (Math.random() * 1.5 - 0.7));
      });

      new Chart(usageCtx, {
        type: "line",
        data: {
          labels: labelsDays,
          datasets: [{
            label: "‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô (kWh)",
            data: kWhPerDay,
            tension: 0.3,
            fill: false
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { title: { display: true, text: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" } },
            y: { title: { display: true, text: "kWh/‡∏ß‡∏±‡∏ô" }, beginAtZero: true }
          }
        }
      });

      // --------- CHART: Cost Breakdown ----------
      const costCtx = document.getElementById("costBreakdownChart").getContext("2d");
      const dayCost = Math.round(spentSoFar * 0.6);
      const nightCost = spentSoFar - dayCost;

      new Chart(costCtx, {
        type: "doughnut",
        data: {
          labels: ["‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", "‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô"],
          datasets: [{
            data: [dayCost, nightCost]
          }]
        },
        options: {
          plugins: { legend: { position: "bottom" } }
        }
      });

      // --------- INSIGHT LIST ----------
      const insightMain = document.getElementById("insightMain");
      const insightList = document.getElementById("insightList");

      insightList.innerHTML = "";

      const diffFromAvg = projected - avg3Months;
      if (diffFromAvg > 0) {
        insightMain.textContent =
          "‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏∞‡∏™‡∏≤‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ.";
        const li1 = document.createElement("li");
        li1.textContent = `‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏° ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏≠‡∏≤‡∏à‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${diffFromAvg.toLocaleString("th-TH")} ‡∏ø`;
        const li2 = document.createElement("li");
        li2.textContent = "‡∏•‡∏≠‡∏á‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏Å ‡πÜ ‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô (‡∏ñ‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏≠‡∏∑‡πâ‡∏≠)";
        const li3 = document.createElement("li");
        li3.textContent = "‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏≥ Early Warning ‡∏ö‡∏ô LINE / Email ‡∏ú‡πà‡∏≤‡∏ô n8n ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢";
        insightList.append(li1, li2, li3);
      } else {
        insightMain.textContent =
          "‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏¢‡∏±‡∏á‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏î‡∏¥‡∏° ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ã‡∏ô‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢.";
        const li1 = document.createElement("li");
        li1.textContent = "‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏•‡∏î‡∏ö‡∏¥‡∏•‡πÑ‡∏ü‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß";
        const li2 = document.createElement("li");
        li2.textContent = "‡∏≠‡∏≤‡∏à‡∏ï‡∏±‡πâ‡∏á threshold ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà 90‚Äì95% ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô";
        insightList.append(li1, li2);
      }

      // --------- PLAN MODAL ----------
      const planModal = document.getElementById("planModal");
      const openPlansButton = document.getElementById("openPlansButton");
      const planSummary = document.getElementById("planSummary");

      openPlansButton.addEventListener("click", () => {
        planModal.style.display = "flex";
      });

      planModal.addEventListener("click", (e) => {
        if (e.target === planModal) {
          planModal.style.display = "none";
        }
      });

      document.querySelectorAll(".option-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const level = btn.dataset.level;
          if (level === "lite") {
            planSummary.textContent =
              "‡πÅ‡∏ú‡∏ô Lite: ‡∏õ‡∏¥‡∏î‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå/‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô, ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏≠‡∏£‡πå +1¬∞C, ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á ‚Äì ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö‡∏°‡∏≤‡∏Å.";
          } else if (level === "balance") {
            planSummary.textContent =
              "‡πÅ‡∏ú‡∏ô Balance: ‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏´‡∏ô‡∏±‡∏Å‡πÑ‡∏õ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ñ‡∏π‡∏Å‡∏Å‡∏ß‡πà‡∏≤, ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏≠‡∏£‡πå/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏≥‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡πà‡∏ô, ‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô.";
          } else if (level === "max") {
            planSummary.textContent =
              "‡πÅ‡∏ú‡∏ô Max: ‡∏õ‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏¥‡∏ô‡πÑ‡∏ü‡∏´‡∏ô‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏ö‡∏ú‡πâ‡∏≤, ‡πÄ‡∏ï‡∏≤‡∏≠‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤, ‡πÅ‡∏≠‡∏£‡πå‡∏´‡∏•‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á), ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏á‡∏ö.";
          }
          planModal.style.display = "none";
        });
      });

      // --------- DETAIL POPUP (‡∏Ñ‡∏•‡∏¥‡∏Å mini-card) ----------
      const detailOverlay = document.getElementById("detailOverlay");
      const detailTitle = document.getElementById("detailTitle");
      const detailChip = document.getElementById("detailChip");
      const detailBody = document.getElementById("detailBody");
      const detailCloseBtn = document.getElementById("detailCloseBtn");

      function openDetail(type) {
        let title = "";
        let chip = "";
        let html = "";

        if (type === "spent") {
          title = "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß";
          chip = "Real-time usage";
          html = `
            <p>‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á ‚Äú‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‚Äù ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå/‡∏ö‡∏¥‡∏•‡∏™‡∏∞‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á.</p>
            <ul>
              <li>‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏ß‡πà‡∏≤ ‚Äú‡πÄ‡∏ú‡∏≤‡∏á‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏µ‡πà‡∏ö‡∏≤‡∏ó‚Äù ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</li>
              <li>‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô input ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì projection ‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</li>
              <li>‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡∏°‡∏≤‡∏à‡∏≤‡∏Å Google Sheets / API ‡∏Ç‡∏≠‡∏á‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞</li>
            </ul>
          `;
        } else if (type === "projected") {
          title = "‡∏ß‡∏¥‡∏ò‡∏µ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô";
          chip = "Projection model";
          html = `
            <p>‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏à‡∏≤‡∏Å<a>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</a>‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏π‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô.</p>
            <ul>
              <li>‡∏™‡∏π‡∏ï‡∏£‡∏á‡πà‡∏≤‡∏¢: (‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß / ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ) √ó ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</li>
              <li>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• AI / Time-series forecasting ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</li>
              <li>‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏¥‡πà‡∏ô ‡πÜ ‡∏ß‡πà‡∏≤‡∏ö‡∏¥‡∏•‡∏à‡∏∞ ‚Äú‡∏ö‡∏≤‡∏ô‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</li>
            </ul>
          `;
        } else if (type === "budget") {
          title = "‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü";
          chip = "Budget / Threshold";
          html = `
            <p>‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î + ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢.</p>
            <ul>
              <li>‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏≠‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô +10% ‡πÄ‡∏õ‡πá‡∏ô Threshold</li>
              <li>‡∏ñ‡πâ‡∏≤ projection ‡πÄ‡∏Å‡∏¥‡∏ô‡∏á‡∏ö‡∏ô‡∏µ‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
              <li>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡∏á‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ê‡∏≤‡∏ô‡∏∞/‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏• ‡πÄ‡∏ä‡πà‡∏ô ‡∏§‡∏î‡∏π‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°</li>
            </ul>
          `;
        } else if (type === "avg") {
          title = "‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∏‡∏î";
          chip = "Baseline";
          html = `
            <p>‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô ‚Äúbaseline‚Äù ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô.</p>
            <ul>
              <li>‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤ ‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÑ‡∏ü‡πÄ‡∏û‡∏¥‡πà‡∏°</li>
              <li>‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥/‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡∏à‡∏∞‡πÑ‡∏î‡πâ insight ‡∏•‡∏∂‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô</li>
              <li>‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á baseline ‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏µ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</li>
            </ul>
          `;
        }

        detailTitle.textContent = title;
        detailChip.textContent = chip;
        detailBody.innerHTML = html;
        detailOverlay.style.display = "flex";
      }

      document.querySelectorAll(".mini-card").forEach(card => {
        card.addEventListener("click", () => {
          const type = card.dataset.type;
          openDetail(type);
        });
      });

      detailOverlay.addEventListener("click", (e) => {
        if (e.target === detailOverlay) {
          detailOverlay.style.display = "none";
        }
      });
      detailCloseBtn.addEventListener("click", () => {
        detailOverlay.style.display = "none";
      });

      // --------- THEME TOGGLE ----------
      const themeToggle = document.getElementById("themeToggle");
      const modeText = document.getElementById("modeText");

      function applyTheme(theme) {
        if (theme === "night") {
          document.body.classList.add("theme-night");
          modeText.textContent = "‡πÇ‡∏´‡∏°‡∏î: ‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏î ‡∏ñ‡∏ô‡∏≠‡∏°‡∏™‡∏≤‡∏¢‡∏ï‡∏≤)";
        } else {
          document.body.classList.remove("theme-night");
          modeText.textContent = "‡πÇ‡∏´‡∏°‡∏î: ‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô /‡∏≠‡∏≠‡∏ü‡∏ü‡∏¥‡∏®)";
        }
      }

      const savedTheme = localStorage.getItem("billshock-theme");
      if (savedTheme) applyTheme(savedTheme);

      themeToggle.addEventListener("click", () => {
        const isNight = document.body.classList.toggle("theme-night");
        const theme = isNight ? "night" : "day";
        localStorage.setItem("billshock-theme", theme);
        applyTheme(theme);
      });
    });
  </script>
</body>

</html>